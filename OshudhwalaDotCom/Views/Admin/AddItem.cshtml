@model OshudhwalaDotCom.Models.Item

@{
    ViewBag.Title = "AddItem";
    Layout = "~/Views/Shared/Common.cshtml";
}

<h2>AddItem</h2>
<style>
    #imgDiv{
        display:none;
        max-height:500px;
        max-width:500px;
    }
    #imageUpload{
        max-height:500px;
        max-width:500px;
    }
</style>

<script src="~/Scripts/jquery-1.9.1.js"></script>
@using (Html.BeginForm()) 
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal">
        <h4>Add Medicine</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.Category, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-sm-3">
                @Html.DropDownList("Category", ViewBag.CategoryList as List<SelectListItem>,new {@class= "form-control" })
                @Html.ValidationMessageFor(model => model.Category, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.SubCategory, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-sm-3">
                @Html.DropDownList("SubCategory", new SelectList(string.Empty, "Value", "Text"), "Select", new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.SubCategory, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.SubSubCategory, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-sm-3">
                @Html.DropDownList("SubSubCategory", new SelectList(string.Empty,"Value","Text"),"Select", new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.SubSubCategory, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Title, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-sm-3">
                @Html.EditorFor(model => model.Title, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Image, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-sm-3">
                @Html.EditorFor(model => model.Image, new { htmlAttributes = new { @class = "", @type="file" } })
                @Html.ValidationMessageFor(model => model.Image, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group" id="imgDiv">
            <label for="imageUpload" class="control-label col-md-3"></label>
            <div>
                <img id="imageUpload" src="" alt="Image is not available" />
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Price, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-sm-3">
                @Html.EditorFor(model => model.Price, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Price, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Description, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-sm-3">
                @Html.EditorFor(model => model.Description, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.IsDanger, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-sm-3">
                @Html.RadioButtonFor(model => model.IsDanger, "1")Yes 
                @Html.RadioButtonFor(model => model.IsDanger, "0") No
                @Html.ValidationMessageFor(model => model.IsDanger, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-4 col-sm-3">
                <input type="submit" value="Submit" class="btn btn-default" />
            </div>
        </div>
    </div>
}
<script>
    $("#Category").change(function () {
        $("#SubCategory").empty();
        $.ajax({
            type: 'POST',
            url: '@Url.Action("SubCategoryList")',
            contentType: "application/json; charset=utf-8",
            data: { id: $('#Category').val() },
            async:false,
            success: function (response) {
                $.each(response, function (key, value) {
                    $("#SubCategory").append('<option value="' + value.Value + '">' + value.Text + '</option>')
                })
                return false;
            },
            error: function (err) {
                console.log(err);
            }
        })
    });
    $("#SubCategory").change(function () {
        $("#SubSubCategory").empty();
        $.ajax({
            type: 'POST',
            url: '@Url.Action("SubSubCategoryList")',
            dataType: 'json',
            data: { id: $('#SubCategory').val() },
            success: function (data) {
                $.each(data, function (key, value) {
                    $("#SubSubCategory").append('<option value="' + value.Value + '">' + value.Text + '</option>')
                })
                return false;
            },
            error: function (err) {
                console.log(err);
            }
        })
    });
    function readURL(input) {
        var reader = new FileReader();
        reader.onload = function (e) {
            $("#imgDiv").show();
            $('#imageUpload').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
    }
    $('#Image').change(function () {
        var fileExtension = ['jpeg', 'jpg', 'png', 'gif', 'bmp'];
        if ($.inArray($(this).val().split('.').pop().toLowerCase(), fileExtension) == -1) {
            alert("Only formats are allowed : " + fileExtension.join(', '));
            $(this).val('');
            $("#imageUpload").attr('src', '');

        } else {
            readURL(this);
        }
    });
</script>